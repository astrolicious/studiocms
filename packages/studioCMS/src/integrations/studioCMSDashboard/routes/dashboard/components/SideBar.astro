---
import SideBarFooter from "./SideBarFooter.astro";
import SideBarMenu from "./SideBarMenu.astro";
import { authHelper, type Locals } from "studiocms:helpers";
import { StudioCMSRoutes } from "studiocms-dashboard:routeMap"
import type { StudioCMSSocials } from "../layouts/studiocms-socials";

type Props = { studioCMSSocials: StudioCMSSocials };
const { studioCMSSocials } = Astro.props as Props;
const { avatar, name, permissionLevel } = await authHelper(Astro.locals as Locals);
const { mainLinks: { dashboardIndex } } = StudioCMSRoutes;

let useName: string;

if ( permissionLevel === "unknown" ) {
  useName = "Guest";
} else {
  if ( !name ) {
    useName = "User";
  } else {
  useName = name;
  }
}

---

<div class="max-md:hidden pr-2">
  <aside class="px-2 pt-2 h-auto min-h-full w-[19rem] bg-base-200 text-base-content flex flex-col">
    <div class="w-fit mx-auto mt-5 mb-6">
      <a href={dashboardIndex}>
        <sl-tooltip content={"Avatar of " + useName}>
          <sl-avatar
            image={avatar?.toString()}
            class="m-auto ease-in-out hover:scale-[102%] transition"
            label={"Avatar of " + useName}
          ></sl-avatar> 
        </sl-tooltip>
      </a>
    </div>
    <div class="text-center pb-2">
      Current User: <b>{useName}</b>
    </div>
    <SideBarMenu />
    <div class="flex-none flex-end">
      <SideBarFooter studioCMSSocials={studioCMSSocials}/>
    </div>
  </aside>
</div>

<style>
  sl-avatar {
    --size: 8.5rem;
  }
</style>